<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>StarHub Joiner</title>
  <meta name="description" content="Join r√°pid em inst√¢ncias espec√≠ficas do Roblox usando placeId e jobId." />
  <style>
    :root { color-scheme: dark; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; padding: 24px; background: #0b0f14; color: #e6eef8; }
    .card { max-width: 720px; margin: 0 auto; background: #121826; border: 1px solid #23324a; border-radius: 12px; padding: 20px; box-shadow: 0 8px 30px rgba(0,0,0,0.35); }
    h1 { margin: 0 0 4px; font-size: 22px; }
    .muted { color: #9fb3c8; margin: 0 0 16px; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 12px 0 4px; }
    label { font-size: 12px; color: #9fb3c8; margin-bottom: 6px; display: inline-block; }
    input { width: 100%; padding: 10px 12px; border-radius: 8px; border: 1px solid #2a3a57; background: #0f1522; color: #e6eef8; }
    .actions { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 16px; }
    button, a.btn { appearance: none; border: none; border-radius: 10px; padding: 10px 14px; font-weight: 600; cursor: pointer; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; }
    .primary { background: #2b86ff; color: white; }
    .secondary { background: #1a2336; color: #e6eef8; border: 1px solid #2a3a57; }
    .ok { color: #7ddc7a; }
    .warn { color: #ffb84d; }
    .error { color: #ff6b6b; }
    .hint { font-size: 12px; color: #9fb3c8; margin-top: 8px; }
    .footer { text-align: center; margin-top: 18px; color: #9fb3c8; font-size: 12px; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
  </style>
</head>
<body>
  <div class="card">
    <h1>üî• StarHub Joiner</h1>
    <p class="muted">Abra o Roblox diretamente em uma inst√¢ncia espec√≠fica com placeId e jobId.</p>

    <div class="row">
      <div>
        <label for="placeId">placeId</label>
        <input id="placeId" placeholder="ex: 109983668079237" inputmode="numeric" />
      </div>
      <div>
        <label for="jobId">gameInstanceId (jobId)</label>
        <input id="jobId" placeholder="ex: 3b7c2f77-9a7a-4a31-9f27-7a4d7a9b3e21" />
      </div>
    </div>

    <div class="actions">
      <button id="joinBtn" class="primary">Entrar no servidor</button>
      <button id="copyJobBtn" class="secondary">Copiar JobID</button>
      <button id="copyLinkBtn" class="secondary">Copiar Link</button>
      <a id="webFallback" class="secondary btn" href="#" target="_blank" rel="noopener">Abrir via site Roblox</a>
    </div>

    <p id="status" class="hint">Informe placeId e jobId e clique em ‚ÄúEntrar no servidor‚Äù.</p>

    <div class="hint">
      Dica: este link suporta query string, ex:
      <span class="mono">?placeId=109983668079237&amp;gameInstanceId=SEU_JOB_ID</span>
    </div>

    <div class="footer">
      Funciona em Desktop e Mobile. Se o app n√£o abrir via protocolo, tentamos abrir pelo site da Roblox.
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const placeInput = $("placeId");
    const jobInput = $("jobId");
    const joinBtn = $("joinBtn");
    const copyJobBtn = $("copyJobBtn");
    const copyLinkBtn = $("copyLinkBtn");
    const statusEl = $("status");
    const webFallbackA = $("webFallback");

    const params = new URLSearchParams(location.search);
    const initialPlace = params.get("placeId") || "";
    const initialJob = params.get("gameInstanceId") || params.get("jobId") || "";

    placeInput.value = initialPlace;
    jobInput.value = initialJob;

    function buildDeepLink(placeId, jobId) {
      return `roblox://experiences/start?placeId=${encodeURIComponent(placeId)}&gameInstanceId=${encodeURIComponent(jobId)}`;
    }
    function buildWebLink(placeId, jobId) {
      return `https://www.roblox.com/games/start?placeId=${encodeURIComponent(placeId)}&gameInstanceId=${encodeURIComponent(jobId)}`;
    }
    function updateFallbackHref() {
      const p = placeInput.value.trim();
      const j = jobInput.value.trim();
      webFallbackA.href = buildWebLink(p, j);
    }
    updateFallbackHref();

    function valid() {
      const p = placeInput.value.trim();
      const j = jobInput.value.trim();
      return p && j && /^[0-9]+$/.test(p) && /^[a-f0-9-]{8,}$/i.test(j);
    }

    function setStatus(msg, kind = "hint") {
      statusEl.textContent = msg;
      statusEl.className = `hint ${kind}`;
    }

    async function copy(text) {
      try { await navigator.clipboard.writeText(text); return true; }
      catch { return false; }
    }

    async function doJoin() {
      const placeId = placeInput.value.trim();
      const jobId = jobInput.value.trim();

      if (!valid()) {
        setStatus("Preencha um placeId num√©rico e um jobId v√°lido (UUID).", "warn");
        return;
      }

      const deep = buildDeepLink(placeId, jobId);
      const web = buildWebLink(placeId, jobId);

      const shareUrl = `${location.origin}${location.pathname}?placeId=${encodeURIComponent(placeId)}&gameInstanceId=${encodeURIComponent(jobId)}`;
      history.replaceState(null, "", shareUrl);
      updateFallbackHref();

      setStatus("Tentando abrir o Roblox via protocolo do app‚Ä¶", "hint");

      const start = Date.now();
      window.location.href = deep;

      setTimeout(() => {
        const elapsed = Date.now() - start;
        if (elapsed < 1200) {
          window.location.href = web;
          setStatus("Se o app n√£o abriu, clique em ‚ÄúAbrir via site Roblox‚Äù.", "warn");
        } else {
          setStatus("Comando enviado ao app Roblox.", "ok");
        }
      }, 1400);
    }

    joinBtn.addEventListener("click", doJoin);
    copyJobBtn.addEventListener("click", async () => {
      const j = jobInput.value.trim();
      if (!j) return setStatus("Nenhum JobID para copiar.", "warn");
      const ok = await copy(j);
      setStatus(ok ? "JobID copiado!" : "Falha ao copiar o JobID.", ok ? "ok" : "error");
    });
    copyLinkBtn.addEventListener("click", async () => {
      const p = placeInput.value.trim();
      const j = jobInput.value.trim();
      const url = `${location.origin}${location.pathname}?placeId=${encodeURIComponent(p)}&gameInstanceId=${encodeURIComponent(j)}`;
      const ok = await copy(url);
      setStatus(ok ? "Link copiado!" : "Falha ao copiar o link.", ok ? "ok" : "error");
    });

    placeInput.addEventListener("input", updateFallbackHref);
    jobInput.addEventListener("input", updateFallbackHref);

    if (initialPlace && initialJob) {
      setTimeout(() => doJoin(), 400);
    }
  </script>
</body>
</html>